!function(e){var t={};function i(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(a,r,function(t){return e[t]}.bind(null,r));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){i(2),e.exports=i(1)},function(e,t,i){},function(e,t,i){"use strict";function a(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return{code:e,value:t,shift:i}}function r(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"virtual-keyboard__key-func-wide";return{code:e,title:t,class:i,shift:!1}}i.r(t);var o={lang:"en",keys:[[a("Backquote","`","~"),a("Digit1","1","!"),a("Digit2","2","@"),a("Digit3","3","#"),a("Digit4","4","$"),a("Digit5","5","%"),a("Digit6","6","^"),a("Digit7","7","&"),a("Digit8","8","*"),a("Digit9","9","("),a("Digit0","0",")"),a("Minus","-","_"),a("Equal","=","+")],[a("KeyQ","q"),a("KeyW","w"),a("KeyE","e"),a("KeyR","r"),a("KeyT","t"),a("KeyY","y"),a("KeyU","u"),a("KeyI","i"),a("KeyO","o"),a("KeyP","p"),a("BracketLeft","[","{"),a("BracketRight","]","}"),a("Backslash","\\","|")],[a("KeyA","a"),a("KeyS","s"),a("KeyD","d"),a("KeyF","f"),a("KeyG","g"),a("KeyH","h"),a("KeyJ","j"),a("KeyK","k"),a("KeyL","l"),a("Semicolon",";",":"),a("Quote","'",'"')],[a("KeyZ","z"),a("KeyX","x"),a("KeyC","c"),a("KeyV","v"),a("KeyB","b"),a("KeyN","n"),a("KeyM","m"),a("Comma",",","<"),a("Period",".",">"),a("Slash","/","?")]]},s=[{lang:"ru",keys:[[a("Backquote","ё"),a("Digit1","1","!"),a("Digit2","2",'"'),a("Digit3","3","№"),a("Digit4","4",";"),a("Digit5","5","%"),a("Digit6","6",":"),a("Digit7","7","?"),a("Digit8","8","*"),a("Digit9","9","("),a("Digit0","0",")"),a("Minus","-","_"),a("Equal","=","+")],[a("KeyQ","й"),a("KeyW","ц"),a("KeyE","у"),a("KeyR","к"),a("KeyT","е"),a("KeyY","н"),a("KeyU","г"),a("KeyI","ш"),a("KeyO","щ"),a("KeyP","з"),a("BracketLeft","х"),a("BracketRight","ъ"),a("Backslash","\\","/")],[a("KeyA","ф"),a("KeyS","ы"),a("KeyD","в"),a("KeyF","а"),a("KeyG","п"),a("KeyH","р"),a("KeyJ","о"),a("KeyK","л"),a("KeyL","д"),a("Semicolon","ж"),a("Quote","э")],[a("KeyZ","я"),a("KeyX","ч"),a("KeyC","с"),a("KeyV","м"),a("KeyB","и"),a("KeyN","т"),a("KeyM","ь"),a("Comma","б"),a("Period","ю"),a("Slash",".",",")]]},o],n=["Backspace","Tab","Delete","CapsLock","Enter","ShiftLeft","ShiftRight","ArrowLeft","ArrowUp","ArrowRight","ArrowDown","ControlLeft","ControlRight","AltLeft","AltRight","Space","MetaLeft","MetaRight"],l=[{right:[r("Backspace","Backspace")]},{left:[r("Tab","Tab")],right:[r("Delete","Del")]},{left:[r("CapsLock","Caps Lock")],right:[r("Enter","ENTER")]},{left:[r("ShiftLeft","Shift")],right:[r("ArrowUp","Up","virtual-keyboard__key-func-arrow"),r("ShiftRight","Shift","virtual-keyboard__key-func-arrow")]},{left:[r("ControlLeft","Ctrl"),r("MetaLeft","Win"),r("AltLeft","Alt"),r("Space","","virtual-keyboard__key-func-space")],right:[r("AltRight","Alt"),r("ControlRight","Ctrl"),r("ArrowLeft","Left","virtual-keyboard__key-func-arrow"),r("ArrowDown","Down","virtual-keyboard__key-func-arrow"),r("ArrowRight","Right","virtual-keyboard__key-func-arrow")]}];function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var d=function(){function e(t,i){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];u(this,e),this.isShifted=!1,this.isPressed=!1,this.el=t,this.char=a,this.code=i,this.shiftCharacter=r,this.el.addEventListener("click",this.clickListener.bind(this))}var t,i,a;return t=e,(i=[{key:"clickListener",value:function(e){e.preventDefault(),this.el.dispatchEvent(new CustomEvent("vir-key-click",{detail:{keyObj:this},bubbles:!0,cancelable:!0}))}},{key:"getValue",value:function(){return!0===this.shiftCharacter&&!0===this.isShifted?this.char.toUpperCase():this.char}},{key:"setShifted",value:function(e,t){!0===this.shiftCharacter&&(e&&!this.isShifted?(this.isShifted=!0,this.el.classList.add(t)):!e&&this.isShifted&&(this.isShifted=!1,this.el.classList.remove(t)))}},{key:"setPressed",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"virtual-keyboard__key-pressed-true";e&&!this.isPressed?(this.isPressed=!0,this.el.classList.add(t)):!e&&this.isPressed&&(this.isPressed=!1,this.el.classList.remove(t))}},{key:"pressAnimatation",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"virtual-keyboard__key-animation-click";this.el.classList.add(t),setTimeout((function(){e.el.classList.remove(t)}),0)}}])&&c(t.prototype,i),a&&c(t,a),e}();function h(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var y=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.outputEl=t}var t,i,a;return t=e,(i=[{key:"write",value:function(e){var t=this.outputEl.selectionStart,i=this.outputEl.selectionEnd,a=this.outputEl.value,r=a.slice(0,t)+e+a.slice(i,a.length);this.outputEl.value=r,this.outputEl.selectionStart=t+1,this.outputEl.selectionEnd=t+1,this.outputEl.focus()}},{key:"backspace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.outputEl.selectionStart,i=this.outputEl.selectionEnd,a=this.outputEl.value,r=a,o=t;t===i&&(!e&&t>0&&(r=a.slice(0,t-1)+a.slice(t,a.length),o-=1),e&&t<a.length&&(r=a.slice(0,t)+a.slice(t+1,a.length))),t!==i&&(r=a.slice(0,t)+a.slice(i,a.length)),this.outputEl.value=r,this.outputEl.selectionStart=o,this.outputEl.selectionEnd=o,this.outputEl.focus()}},{key:"navigate",value:function(e){var t=this.outputEl.selectionStart,i=this.outputEl.selectionEnd;switch(e){case"left":this.outputEl.selectionStart=t-1,this.outputEl.selectionEnd=t-1;break;case"right":this.outputEl.selectionStart=i+1,this.outputEl.selectionEnd=i+1;break;case"up":this.outputEl.selectionStart=0,this.outputEl.selectionEnd=0;break;case"down":this.outputEl.selectionStart=this.outputEl.value.length,this.outputEl.selectionEnd=this.outputEl.value.length}this.outputEl.focus()}}])&&h(t.prototype,i),a&&h(t,a),e}();function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],a=!0,r=!1,o=void 0;try{for(var s,n=e[Symbol.iterator]();!(a=(s=n.next()).done)&&(i.push(s.value),!t||i.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(r)throw o}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return v(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var k=function(){function e(t,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s;p(this,e),this.writer=new y(i),this.layouts={},this.layoutCodes=[],this.selectedLayoutCode=null,this.rootDomElement=null,this.observedKeyCodes={},this.initData(a),this.pressedFunctionalButtons=new Set,t.appendChild(this.rootDomElement),this.initClicksListener(),this.initPhysicalKeyListener()}var t,i,a;return t=e,(i=[{key:"isShiftEnabled",value:function(){return this.pressedFunctionalButtons.has("ShiftLeft")||this.pressedFunctionalButtons.has("ShiftRight")}},{key:"toggleShift",value:function(){var e=this,t=this.isShiftEnabled();Object.keys(this.observedKeyCodes[this.selectedLayoutCode]).forEach((function(i){e.observedKeyCodes[e.selectedLayoutCode][i].setShifted(t,"virtual-keyboard__key-shifted-true")}))}},{key:"initPhysicalKeyListener",value:function(){var e=this,t=function(t){t.preventDefault();var i=t.repeat,a=t.type,r=t.code,o="keyup"!==a,s=e.observedKeyCodes[e.selectedLayoutCode][r];if(s)if(i||(s.setPressed(o),o&&s.pressAnimatation()),n.includes(r))switch(r){case"Backspace":o&&e.writer.backspace();break;case"Delete":o&&e.writer.backspace(!0);break;case"Space":o&&e.writer.write(" ");break;case"Enter":o&&e.writer.write("\n");break;case"Tab":o&&e.writer.write("\t");break;case"ArrowLeft":case"ArrowUp":case"ArrowRight":case"ArrowDown":o&&e.writer.navigate(r.slice(5).toLowerCase());break;case"ShiftRight":case"ShiftLeft":case"AltLeft":case"AltRight":case"ControlLeft":case"ControlRight":o?e.pressedFunctionalButtons.add(r):e.pressedFunctionalButtons.delete(r),e.checkLayoutToggleCombo(r),e.toggleShift()}else o&&e.writer.write(s.getValue())};document.onkeydown=t,document.onkeyup=t}},{key:"initClicksListener",value:function(){var e=this;this.rootDomElement.addEventListener("vir-key-click",(function(t){var i=t.detail.keyObj;i.pressAnimatation();var a=i.code;if(n.includes(a))switch(a){case"Backspace":e.writer.backspace();break;case"Delete":e.writer.backspace(!0);break;case"Space":e.writer.write(" ");break;case"Enter":e.writer.write("\n");break;case"Tab":e.writer.write("\t");break;case"ArrowLeft":case"ArrowUp":case"ArrowRight":case"ArrowDown":e.writer.navigate(a.slice(5).toLowerCase());break;case"ShiftRight":case"ShiftLeft":case"AltLeft":case"AltRight":case"ControlLeft":case"ControlRight":e.funcKeyPressedToggleByKeyCode(a),e.toggleShift()}else{var r=i.getValue();e.writer.write(r)}}))}},{key:"funcKeyPressedToggleByKeyCode",value:function(e){var t=this.observedKeyCodes[this.selectedLayoutCode][e];this.pressedFunctionalButtons.has(e)?(this.pressedFunctionalButtons.delete(e),t.setPressed(!1)):this.checkLayoutToggleCombo(e)||(this.pressedFunctionalButtons.add(e),t.setPressed(!0))}},{key:"checkLayoutToggleCombo",value:function(e){var t=!1,i=!1;switch(e){case"AltLeft":i="ControlLeft";break;case"AltRight":i="ControlRight";break;case"ControlLeft":i="AltLeft";break;case"ControlRight":i="AltRight";break;default:return!1}return this.pressedFunctionalButtons.has(i)&&(this.funcKeyPressedToggleByKeyCode(i),this.nextLayout(),t=!0),t}},{key:"initData",value:function(e){var t=this;this.rootDomElement=document.createElement("div"),this.rootDomElement.classList.add("virtual-keyboard"),this.generateLayouts(e),this.nextLayout(!0),this.layoutCodes.forEach((function(e){var i=t.layouts[e];t.rootDomElement.appendChild(i)})),this.displayCurrentLayout()}},{key:"nextLayout",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!0!==t){this.pressedFunctionalButtons.forEach((function(t){e.funcKeyPressedToggleByKeyCode(t)})),this.toggleShift();var i=this.layoutCodes.indexOf(this.selectedLayoutCode);if(i+1===this.layoutCodes.length){var a=f(this.layoutCodes,1),r=a[0];this.selectedLayoutCode=r}else{var o=this.layoutCodes[i+1];this.selectedLayoutCode=o}localStorage.setItem("layout",this.selectedLayoutCode),this.displayCurrentLayout()}else{try{var s=localStorage.getItem("layout");if(this.layoutCodes.includes(s))return void(this.selectedLayoutCode=s);var n=f(this.layoutCodes,1);s=n[0],this.selectedLayoutCode=s}catch(e){var l=f(this.layoutCodes,1),u=l[0];this.selectedLayoutCode=u}localStorage.setItem("layout",this.selectedLayoutCode)}}},{key:"displayCurrentLayout",value:function(){var e=this;this.layoutCodes.forEach((function(t){var i=e.layouts[t];i.classList.add("virtual-keyboard__layout"),t!==e.selectedLayoutCode?i.classList.add("virtual-keyboard__layout-hidden-true"):i.classList.remove("virtual-keyboard__layout-hidden-true")}))}},{key:"generateLayouts",value:function(e){var t=this;e.forEach((function(e){var i=f(t.createLangLayout(e),2),a=i[0],r=i[1];t.layouts[e.lang]=a,t.observedKeyCodes[e.lang]=r,t.layoutCodes.push(e.lang)}))}},{key:"createLangLayout",value:function(e){var t=document.createElement("div"),i={},a=0;return l.forEach((function(r){var o=document.createElement("div");o.classList.add("virtual-keyboard__row"),Object.prototype.hasOwnProperty.call(r,"left")&&r.left.length>0&&r.left.forEach((function(e){var t=document.createElement("div");t.classList.add("virtual-keyboard__key"),t.innerHTML="<span>".concat(e.title,"</span>"),t.classList.add(e.class),o.appendChild(t),i[e.code]=new d(t,e.code)})),void 0!==e.keys[a]&&e.keys[a].forEach((function(e){var t=e.value,a=e.shift,r=document.createElement("div");r.classList.add("virtual-keyboard__key"),!0===e.shift&&(a=t.toUpperCase(),r.classList.add("virtual-keyboard__key-type-char")),r.innerHTML="<span>".concat(a,"</span><span>").concat(t,"</span>"),o.appendChild(r),i[e.code]=new d(r,e.code,e.value,e.shift)})),Object.prototype.hasOwnProperty.call(r,"right")&&r.right.length>0&&r.right.forEach((function(e){var t=document.createElement("div");t.classList.add("virtual-keyboard__key"),t.innerHTML="<span>".concat(e.title,"</span>"),t.classList.add(e.class),o.appendChild(t),i[e.code]=new d(t,e.code)})),t.appendChild(o),a+=1})),[t,i]}}])&&g(t.prototype,i),a&&g(t,a),e}();window.onload=function(){var e=document.createElement("div");e.classList.add("wrapper"),e.innerHTML='<div class="output"><textarea id="output" class="output__textarea">Смена раскладки - Ctrl+Alt</textarea></div><div id="keyboard"></div>',document.body.prepend(e);var t=document.getElementById("output"),i=document.getElementById("keyboard");new k(i,t)}}]);